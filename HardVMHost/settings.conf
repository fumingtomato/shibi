# =================================================================
# VM Host Hardener v2.0 - Configuration Settings
#
# This file controls the entire hardening process. Review and edit
# these settings before running the main script.
# =================================================================

# --- General Settings ---
# Log file for the hardening script's operations.
LOG_FILE="/var/log/vm-host-hardening.log"
# Location for the final security report.
REPORT_FILE="/root/vm-host-security-report.txt"

# --- User Management ---
# Set to 'true' to create a dedicated administrator user for managing VMs.
CREATE_ADMIN_USER="true"
# Username for the dedicated administrator.
ADMIN_USER="vmadmin"
# PUBLIC SSH key to be installed for the admin user.
# The script will NOT proceed without a valid key if CREATE_ADMIN_USER is true.
# Replace this with the actual public key. Example: "ssh-ed25519 AAAA..."
ADMIN_USER_SSH_KEY="<PASTE YOUR PUBLIC SSH KEY HERE>"

# --- SSH Hardening ---
# Set the port for the SSH service.
SSH_PORT="22"
# Prohibit root login via SSH. Recommended: "prohibit-password" or "yes" (if using keys).
PERMIT_ROOT_LOGIN="prohibit-password"
# Disable password authentication entirely (highly recommended).
PASSWORD_AUTHENTICATION="no"
# Set a list of strong ciphers, MACs, and KexAlgorithms.
# These are modern, secure defaults.
SSH_CIPHERS="chacha20-poly1305@openssh.com,aes256-gcm@openssh.com,aes128-gcm@openssh.com,aes256-ctr,aes192-ctr,aes128-ctr"
SSH_MACS="hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com,hmac-sha2-512,hmac-sha2-256"
SSH_KEX_ALGORITHMS="curve25519-sha256@libssh.org,diffie-hellman-group-exchange-sha256"

# --- Firewall (UFW) Configuration ---
# Set to 'true' to enable and configure UFW.
ENABLE_UFW="true"
# A comma-separated list of ports to open for VM services.
# These are the ports that will be exposed on the host's public interface.
# Default ports for Mail, Web, and NextCloud are included.
# Format: port/protocol (e.g., 80/tcp)
ALLOWED_PORTS="80/tcp,443/tcp,25/tcp,587/tcp,465/tcp,143/tcp,993/tcp"
# Set to 'true' to allow libvirt remote management over TLS (port 16514).
ALLOW_LIBVIRT_TLS="false"

# --- Libvirt & QEMU Hardening ---
# AppArmor is the recommended security driver for Ubuntu.
QEMU_SECURITY_DRIVER="apparmor"

# --- Storage & Backup ---
# Enable automated backups.
ENABLE_BACKUPS="true"
# Directory to store VM backups.
BACKUP_DIRECTORY="/var/backups/vms"
# Number of backups to retain per VM.
BACKUP_RETENTION_COUNT="3"
# Cron schedule for backups. Default is 01:00 every Sunday.
BACKUP_CRON_SCHEDULE="0 1 * * 0"

# --- Monitoring & Auditing ---
# Enable system auditing with auditd.
ENABLE_AUDITD="true"
# Enable a cron job for resource monitoring.
ENABLE_MONITORING_CRON="true"
# Cron schedule for the monitoring script. Default is every 15 minutes.
MONITORING_CRON_SCHEDULE="*/15 * * * *"

# --- Kernel Hardening ---
# Enable kernel hardening via sysctl parameters.
ENABLE_KERNEL_HARDENING="true"
